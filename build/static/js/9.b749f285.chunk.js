(this["webpackJsonplets-chat"]=this["webpackJsonplets-chat"]||[]).push([[9],{191:function(e,t,a){"use strict";t.a=a.p+"static/media/avatar-1.3921191a.jpg"},337:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return te}));var s=a(14),r=a.n(s),n=a(65),c=a(47),l=a(48),i=a(67),m=a(66),o=a(1),u=a.n(o),d=a(8),h=a(45),p=a(328),f=a(329),E=a(64),v=a(258),b=a(322),g=a(323),N=a(257),x=a(36);var y=function(e){var t=e.isOpen,a=e.toggleCollapse;return u.a.createElement(u.a.Fragment,null,u.a.createElement(x.b,{to:"#",onClick:a,className:"text-dark"},u.a.createElement(b.a,{id:"profile-user-headingOne"},u.a.createElement("h5",{className:"font-size-14 m-0"},e.iconClass&&u.a.createElement("i",{className:e.iconClass+" mr-2 align-middle d-inline-block"}),e.title,u.a.createElement("i",{className:t?"mdi mdi-chevron-up float-right accor-plus-icon":"mdi mdi-chevron-right float-right accor-plus-icon"})))),u.a.createElement(g.a,{isOpen:t},u.a.createElement(N.a,null,e.children)))};var w=a(85),O=a(132),k=a(136),j=a(324),C=a(308),U=a(192),S=a(176);a(191);var D=function(e){var t=Object(o.useState)(!1),a=Object(E.a)(t,2),s=a[0],r=a[1],n=Object(o.useState)(!0),c=Object(E.a)(n,2),l=c[0],i=c[1],m=Object(o.useState)(!1),d=Object(E.a)(m,2),h=(d[0],d[1]),p=Object(o.useState)(!1),f=Object(E.a)(p,2),b=f[0],g=f[1],N=Object(o.useState)(!1),D=Object(E.a)(N,2),z=D[0],_=D[1];return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",null,u.a.createElement("div",{className:"px-4 pt-4"},u.a.createElement("h4",{className:"mb-0"},"Settings")),u.a.createElement("div",{className:"text-center border-bottom p-4"},u.a.createElement("div",{className:"mb-4 profile-user"},u.a.createElement("img",{src:e.userDetails.image,className:"rounded-circle avatar-lg img-thumbnail",alt:"letschat"}),u.a.createElement(w.a,{type:"button",color:"light",className:"avatar-xs p-0 rounded-circle profile-photo-edit"},u.a.createElement("i",{className:"ri-pencil-fill"}))),u.a.createElement("h5",{className:"font-size-16 mb-1 text-truncate"},e.userDetails.name),u.a.createElement(O.a,{isOpen:s,toggle:function(){return r(!s)},className:"d-inline-block mb-1"},u.a.createElement(k.a,{tag:"a",className:"text-muted pb-1 d-block"},e.userDetails.isOnline?"Active":"Away"," ",u.a.createElement("i",{className:"mdi mdi-chevron-down"})))),u.a.createElement(S.a,{style:{maxHeight:"100%"},className:"p-4 user-profile-desc"},u.a.createElement("div",{className:"text-muted text-center"},u.a.createElement("p",{className:"mb-4"},""!==e.userDetails.status?e.userDetails.status:"No Status")),u.a.createElement("div",{id:"profile-setting-accordion",className:"custom-accordion"},u.a.createElement(v.a,{className:"shadow-none border mb-2"},u.a.createElement(y,{title:"Personal Info",isOpen:l,toggleCollapse:function(){i(!l),h(!1),g(!1),_(!1)}},u.a.createElement("div",{className:"float-right"},u.a.createElement(w.a,{color:"light",size:"sm",type:"button"},u.a.createElement("i",{className:"ri-edit-fill mr-1 align-middle"})," ","Edit")),u.a.createElement("div",null,u.a.createElement("p",{className:"text-muted mb-1"},"Name"),u.a.createElement("h5",{className:"font-size-14"},""!==e.userDetails.name?e.userDetails.name:"No Name")),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Email"),u.a.createElement("h5",{className:"font-size-14"},""!==e.userDetails.email?e.userDetails.email:"No Email")),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Location"),u.a.createElement("h5",{className:"font-size-14"},""!==e.userDetails.location?e.userDetails.location:"Location Not Available")),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Description"),u.a.createElement("h5",{className:"font-size-14 mb-0"},""!==e.userDetails.description?e.userDetails.description:"Description Not Available")))),u.a.createElement(v.a,{className:"shadow-none border mb-2"}),u.a.createElement(v.a,{className:"shadow-none border mb-2"},u.a.createElement(y,{title:"Security",isOpen:b,toggleCollapse:function(){g(!b),i(!1),h(!1),_(!1)}},u.a.createElement("div",null,u.a.createElement(j.a,{className:"align-items-center"},u.a.createElement(j.a,{body:!0,className:"overflow-hidden"},u.a.createElement("h5",{className:"font-size-13 mb-0 text-truncate"},"Deactivate Account")),u.a.createElement("div",{className:"ml-2"},u.a.createElement("div",{className:"custom-control custom-switch"},u.a.createElement(C.a,{type:"checkbox",className:"custom-control-input",id:"security-notificationswitch"}),u.a.createElement(U.a,{className:"custom-control-label",htmlFor:"security-notificationswitch"}))))))),u.a.createElement(v.a,{className:"shadow-none border mb-2"},u.a.createElement(y,{title:"Help",isOpen:z,toggleCollapse:function(){_(!z),i(!1),g(!1),h(!1)}},u.a.createElement("div",null,u.a.createElement("div",{className:"py-3"},u.a.createElement("h5",{className:"font-size-13 mb-0"},u.a.createElement(x.b,{to:"#",className:"text-body d-block"},"FAQs"))),u.a.createElement("div",{className:"py-3 border-top"},u.a.createElement("h5",{className:"font-size-13 mb-0"},u.a.createElement(x.b,{to:"#",className:"text-body d-block"},"Contact"))),u.a.createElement("div",{className:"py-3 border-top"},u.a.createElement("h5",{className:"font-size-13 mb-0"},u.a.createElement(x.b,{to:"#",className:"text-body d-block"},"Terms & Privacy policy"))))))))))},z=a(135),_=a(311),F=a(321),A=a(338),M=a(325),I=a(326),L=a(309),T=a(310),B=a(193),H=a(327),V=a(63),P=a(46),R=function(e){Object(i.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(c.a)(this,a);for(var s=arguments.length,l=new Array(s),i=0;i<s;i++)l[i]=arguments[i];return(e=t.call.apply(t,[this].concat(l))).state={searchChat:"",modal:!1,isOpenCollapse:!1,newChatUserEmail:"",newChatUserMessage:"",isOpenAlert:!1,errormessage:"",chatexistsId:"",filteredData:[]},e.goToChat=Object(n.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.setState({errormessage:"Chat Already Exists",isOpenAlert:!0});case 1:case"end":return t.stop()}}),t)}))),e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=document.getElementById("conversation"+this.props.active_user);e&&e.classList.add("active")}},{key:"toggle",value:function(){console.log(this.state),this.setState({modal:!this.state.modal})}},{key:"toggleCollapse",value:function(){this.setState({isOpenCollapse:!this.state.isOpenCollapse})}},{key:"openUserChat",value:function(e,t){e.preventDefault();var a=this.props.chats.indexOf(t);this.props.activeUser(a);var s=document.getElementById("chat-list"),r=e.target,n=null;if(s){for(var c=s.getElementsByTagName("li"),l=0;l<c.length;++l)c[l].classList.contains("active")&&c[l].classList.remove("active");for(var i=0;i<c.length;++i)if(c[i].contains(r)){n=c[i];break}}n&&n.classList.add("active");var m=document.getElementsByClassName("user-chat");m&&m[0].classList.add("user-chat-show");var o=document.getElementById("unRead"+t.id);o&&(o.style.display="none")}},{key:"userExists",value:function(){var e=Object(n.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(P.b)().firestore().collection("users").get();case 2:return t=e.sent,e.prev=3,a=t.docs.map((function(e){return e.data().email})).includes(this.state.newChatUserEmail),e.abrupt("return",a);case 8:return e.prev=8,e.t0=e.catch(3),console.log(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"chatExists",value:function(){var e=Object(n.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[this.state.newChatUserEmail,this.props.userEmail].sort().join(":"),e.next=3,Object(P.b)().firestore().collection("chats").doc(t).get();case 3:return a=e.sent,e.abrupt("return",a.exists);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createNewChat",value:function(){var e=Object(n.a)(r.a.mark((function e(){var t,a,s,n,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userExists();case 2:if(t=e.sent,a=this.state,s=a.newChatUserEmail,n=a.newChatUserMessage,c=this.props.userEmail,!s||!n||s===c){e.next=16;break}if(!t){e.next=13;break}return e.next=9,this.chatExists();case 9:l=e.sent;try{l?this.goToChat():(this.createChat(c,s,n),this.setState({modal:!this.state.modal}))}catch(r){console.log(r)}e.next=14;break;case 13:this.setState({errormessage:"User Is not registered",isOpenAlert:!0});case 14:e.next=17;break;case 16:this.setState({errormessage:"Please Enter Valid Data",isOpenAlert:!0});case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createChat",value:function(){var e=Object(n.a)(r.a.mark((function e(t,a,s){var n,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.state.newChatUserEmail,this.props.userEmail].sort().join(":"),c=Date.now(),l=Date.now(),console.log({docid:n,time:c,users:[t,a],typing:[],messages:[{message:s,sender:t,time:l,type:"text"}]}),e.next=6,Object(P.b)().firestore().collection("chats").doc(n).set({docid:n,time:c,users:[t,a],typing:[],messages:[{message:s,sender:t,time:l,type:"text"}]});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a,s){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",null,u.a.createElement("div",{className:"px-4 pt-4"},u.a.createElement("div",{className:"user-chat-nav float-right"},u.a.createElement("div",{id:"create-chat"},u.a.createElement(w.a,{onClick:function(){return e.setState({modal:!e.state.modal})},type:"button",color:"link",className:"text-decoration-none text-muted font-size-18 py-0"},u.a.createElement("i",{className:"ri-message-3-line ri-xl"}))),u.a.createElement(z.a,{target:"create-chat",placement:"bottom"},"New Chat")),u.a.createElement(A.a,{isOpen:this.state.modal,centered:!0,toggle:function(){return e.setState({modal:!e.state.modal})}},u.a.createElement(M.a,{tag:"h5",className:"modal-title font-size-16",toggle:function(){return e.setState({modal:!e.state.modal})}},"Start New Chat"),u.a.createElement(I.a,{className:"p-4"},u.a.createElement(L.a,null,u.a.createElement(T.a,{className:"mb-4"},u.a.createElement(B.a,{isOpen:this.state.isOpenAlert,color:"danger"},this.state.errormessage),u.a.createElement(U.a,{htmlFor:"newchatemail-input"},"User Email Id"),u.a.createElement(C.a,{type:"text",className:"form-control",id:"newchatemail-input",value:this.state.newChatUserEmail,onChange:function(t){return e.setState({newChatUserEmail:t.target.value})},placeholder:"Enter User Email ID"})),u.a.createElement(T.a,null,u.a.createElement(U.a,{htmlFor:"newChatmessage-input"},"Message"),u.a.createElement(C.a,{type:"text",className:"form-control",id:"newChatmessage-input",value:this.state.newChatUserMessage,onChange:function(t){return e.setState({newChatUserMessage:t.target.value})},placeholder:"Enter Message"})))),u.a.createElement(H.a,null,u.a.createElement(w.a,{type:"button",color:"link",onClick:function(){return e.setState({modal:!e.state.modal})}},"Close"),u.a.createElement(w.a,{type:"button",color:"primary",onClick:this.createNewChat.bind(this)},"Start Chatting"))),u.a.createElement("h4",{className:"mb-4"},"Chats"),u.a.createElement("div",{className:"search-box chat-search-box"},u.a.createElement(_.a,{size:"lg",className:"mb-3 bg-light rounded-lg"},u.a.createElement(F.a,{addonType:"prepend"},u.a.createElement(w.a,{color:"link",className:"text-muted pr-1 text-decoration-none",type:"button"},u.a.createElement("i",{className:"ri-search-line search-icon font-size-18"}))),u.a.createElement(C.a,{type:"text",value:this.state.searchChat,onChange:function(t){return e.handleChange(t)},className:"form-control bg-light",placeholder:"Search messages or users"})))),u.a.createElement("div",{className:"px-2"},u.a.createElement("h5",{className:"mb-3 px-3 font-size-16"},"Recent"),u.a.createElement(S.a,{style:{maxHeight:"100%"},className:"chat-message-list"},u.a.createElement("ul",{className:"list-unstyled chat-list chat-user-list",id:"chat-list"},this.props.chats.length>0?this.props.chats.map((function(t,a){return u.a.createElement("li",{key:a,id:"conversation"+a,className:a===e.props.active_user?"active":""},u.a.createElement(x.b,{to:"#",onClick:function(a){return e.openUserChat(a,t)}},u.a.createElement(j.a,null,u.a.createElement("div",{className:"chat-user-img "+t.status+" align-self-center mr-3"},u.a.createElement("img",{src:e.props.allUserData.map((function(a){return a.email===(t.users[0]!==e.props.userEmail?t.users[0]:t.users[1])?a.image:""})).join("").trim(""),className:"rounded-circle avatar-xs",alt:"letschat"}),t.status&&u.a.createElement("span",{className:"user-status"})),u.a.createElement(j.a,{body:!0,className:"overflow-hidden"},u.a.createElement("h5",{className:"text-truncate font-size-15 mb-1"},e.props.allUserData.map((function(a){return a.email===(t.users[0]!==e.props.userEmail?t.users[0]:t.users[1])?a.name:""}))),u.a.createElement("p",{className:"chat-user-message text-truncate mb-0"},t.typing.length>0&&t.typing.includes(t.users[0]!==e.props.userEmail?t.users[0]:t.users[1])?u.a.createElement(u.a.Fragment,null,u.a.createElement("span",{className:"animate-typing",style:{color:"#7269ef"}},"typing",u.a.createElement("span",{className:"dot ml-1",style:{color:"#7269ef"}}),u.a.createElement("span",{className:"dot ml-1",style:{color:"#7269ef"}}),u.a.createElement("span",{className:"dot ml-1",style:{color:"#7269ef"}}))):u.a.createElement(u.a.Fragment,null,t.messages&&t.messages.length>0?t.messages[t.messages.length-1].message:null))),u.a.createElement("div",{className:"font-size-11"},t.messages&&t.messages.length>0?t.messages[t.messages.length-1].time.seconds:null))))})):"No Chats Available")))))}}]),a}(u.a.Component),J=Object(h.b)((function(e){return{active_user:e.Chat.active_user}}),{setconversationNameInOpenChat:V.k,activeUser:V.a})(R);var G=Object(h.b)((function(e){return Object(d.a)({},e.Layout)}),null)((function(e){var t=e.activeTab;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"chat-leftsidebar mr-lg-1"},u.a.createElement(p.a,{activeTab:t},u.a.createElement(f.a,{tabId:"chat",id:"pills-chat"},u.a.createElement(J,{history:e.history,chats:e.chats,userEmail:e.userEmail,allUserData:e.allUserData})),u.a.createElement(f.a,{tabId:"settings",id:"pills-setting"},u.a.createElement(D,{userDetails:e.allUserData.find((function(t){return t.email===e.userEmail}))})))))})),Q=a(16);var q=Object(h.b)((function(e){return{active_user:e.Chat.active_user,userSidebar:e.Layout.userSidebar}}),{closeUserSidebar:V.c})((function(e){var t=Object(o.useState)(!0),a=Object(E.a)(t,2),s=a[0],r=a[1];return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{style:{display:!0===e.userSidebar?"block":"none"},className:"user-profile-sidebar"},u.a.createElement("div",{className:"px-3 px-lg-4 pt-3 pt-lg-4"},u.a.createElement("div",{className:"user-chat-nav text-right"},u.a.createElement(w.a,{color:"none",type:"button",onClick:function(){e.closeUserSidebar()},className:"nav-btn",id:"user-profile-hide"},u.a.createElement("i",{className:"ri-close-line"})))),u.a.createElement("div",{className:"text-center p-4 border-bottom"},u.a.createElement("div",{className:"mb-4 d-flex justify-content-center"},"Null"===e.activeUser.image?u.a.createElement("div",{className:"avatar-lg"},u.a.createElement("span",{className:"avatar-title rounded-circle bg-soft-primary text-primary font-size-24"},e.activeUser.name.charAt(0))):u.a.createElement("img",{src:e.activeUser.image,className:"rounded-circle avatar-lg img-thumbnail",alt:"letschat"})),u.a.createElement("h5",{className:"font-size-16 mb-1 text-truncate"},e.activeUser.name),u.a.createElement("p",{className:"text-muted text-truncate mb-1"},e.activeUser?u.a.createElement(u.a.Fragment,null," ",u.a.createElement("i",{className:"ri-record-circle-fill font-size-10 text-success mr-1"})," "):u.a.createElement(u.a.Fragment,null," ",u.a.createElement("i",{className:"ri-record-circle-fill font-size-10 text-secondary mr-1"})),"Active")),u.a.createElement(S.a,{style:{maxHeight:"100%"},className:"p-4 user-profile-desc"},u.a.createElement("div",{className:"text-muted"},u.a.createElement("p",{className:"mb-4"},'"',"If several languages coalesce, the grammar of the resulting language is more simple and regular than that of the individual.",'"')),u.a.createElement("div",{id:"profile-user-accordion",className:"custom-accordion"},u.a.createElement(v.a,{className:"shadow-none border mb-2"},u.a.createElement(y,{title:"About",iconClass:"ri-user-2-line",isOpen:s,toggleCollapse:function(){r(!s)}},u.a.createElement("div",null,u.a.createElement("p",{className:"text-muted mb-1"},"Name"),u.a.createElement("h5",{className:"font-size-14"},e.activeUser.name)),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Email"),u.a.createElement("h5",{className:"font-size-14"},e.activeUser.email)),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Description"),u.a.createElement("h5",{className:"font-size-14"},e.activeUser.description)),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Location"),u.a.createElement("h5",{className:"font-size-14 mb-0"},e.activeUser.location))))))))})),K=a(312),W=a(313),X=a(133),Y=a(134);var Z=Object(h.b)((function(e){var t=e.Chat.active_user;return Object(d.a)(Object(d.a)({},e.Layout),{},{active_user:t})}),{openUserSidebar:V.g,setFullUser:V.j})((function(e){var t=Object(o.useState)(!1),a=Object(E.a)(t,2),s=a[0],r=a[1],n=function(t){t.preventDefault(),e.openUserSidebar()};return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"p-3 p-lg-4 border-bottom"},u.a.createElement(K.a,{className:"align-items-center"},u.a.createElement(W.a,{sm:4,xs:8},u.a.createElement(j.a,{className:"align-items-center"},u.a.createElement("div",{className:"d-block d-lg-none mr-2"},u.a.createElement(x.b,{to:"#",onClick:function(e){return function(e){e.preventDefault();var t=document.getElementsByClassName("user-chat");t&&t[0].classList.remove("user-chat-show")}(e)},className:"user-chat-remove text-muted font-size-16 p-2"},u.a.createElement("i",{className:"ri-arrow-left-s-line"}))),u.a.createElement("div",{className:"mr-3"},u.a.createElement("img",{src:e.allUserData.map((function(t){return t.email===(e.chats[e.active_user].users[0]!==e.userEmail?e.chats[e.active_user].users[0]:e.chats[e.active_user].users[1])?t.image:""})).join("").trim(""),className:"rounded-circle avatar-xs",alt:"letschat"})),u.a.createElement(j.a,{body:!0,className:"overflow-hidden"},u.a.createElement("h5",{className:"font-size-16 mb-0 text-truncate"},u.a.createElement(x.b,{to:"#",onClick:function(e){return n(e)},className:"text-reset user-profile-show"},e.allUserData.map((function(t){return t.email===(e.chats[e.active_user].users[0]!==e.userEmail?e.chats[e.active_user].users[0]:e.chats[e.active_user].users[1])?t.name:""}))),e.allUserData.map((function(t,a){return t.email===(e.chats[e.active_user].users[0]!==e.userEmail?e.chats[e.active_user].users[0]:e.chats[e.active_user].users[1])?t.isOnline?u.a.createElement("i",{key:a,className:"ri-record-circle-fill font-size-10 text-success d-inline-block ml-1"}):u.a.createElement("i",{key:a,className:"ri-record-circle-fill font-size-10 text-secondary d-inline-block ml-1"}):""}))),e.chats[e.active_user].typing.length>0&&e.chats[e.active_user].typing.includes(e.chats[e.active_user].users[0]!==e.userEmail?e.chats[e.active_user].users[0]:e.chats[e.active_user].users[1])&&u.a.createElement("p",{className:"mb-0"},"typing",u.a.createElement("span",{className:"animate-typing"},u.a.createElement("span",{className:"dot ml-1"}),u.a.createElement("span",{className:"dot ml-1"}),u.a.createElement("span",{className:"dot ml-1"})))))),u.a.createElement(W.a,{sm:8,xs:4},u.a.createElement("ul",{className:"list-inline user-chat-nav text-right mb-0"},u.a.createElement("li",{className:"list-inline-item d-none d-lg-inline-block"},u.a.createElement(w.a,{type:"button",color:"none",onClick:function(e){return n(e)},className:"nav-btn user-profile-show"},u.a.createElement("i",{className:"ri-user-2-line"}))),u.a.createElement("li",{className:"list-inline-item"},u.a.createElement(O.a,{isOpen:s,toggle:function(){return r(!s)}},u.a.createElement(k.a,{className:"btn nav-btn ",color:"none",type:"button"},u.a.createElement("i",{className:"ri-more-fill"})),u.a.createElement(X.a,{right:!0},u.a.createElement(Y.a,{className:"d-block d-lg-none user-profile-show",onClick:function(e){return n(e)}},"View profile"," ",u.a.createElement("i",{className:"ri-user-2-line float-right text-muted"}))))))))))}));a(314);var $=function(e){var t=Object(o.useState)(""),a=Object(E.a)(t,2),s=a[0],c=a[1],l=Object(o.useState)({name:"",size:""}),i=Object(E.a)(l,2),m=i[0],d=i[1],h=Object(o.useState)(""),p=Object(E.a)(h,2),f=p[0],v=p[1],b=function(){var t=Object(n.a)(r.a.mark((function t(){var a,s,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.chats.docid,s=e.userEmail,t.next=4,g(a);case 4:if((n=t.sent).includes(s)){t.next=8;break}return t.next=8,n.push(s);case 8:return console.log(n),t.next=11,Object(P.b)().firestore().collection("chats").doc(a).update({typing:n});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),g=function(){var e=Object(n.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(P.b)().firestore().collection("chats").doc(t).get().then((function(e){return e.data().typing}));case 3:return a=e.sent,e.abrupt("return",a);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(n.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var t=Object(n.a)(r.a.mark((function t(){var a,s,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.chats.docid,s=e.userEmail,t.next=4,g(a);case 4:return n=(n=t.sent).filter((function(e){if(e!==s)return e})),console.log(n),t.next=9,Object(P.b)().firestore().collection("chats").doc(a).update({typing:n});case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"p-3 p-lg-4 border-top mb-0"},u.a.createElement(L.a,{onSubmit:function(t){return function(t,a){t.preventDefault(),""!==a&&(e.onaddMessage(a,"textMessage"),c("")),""!==m.name&&(e.onaddMessage(m,"fileMessage"),d({name:"",size:""})),""!==f&&(e.onaddMessage(f,"imageMessage"),v(""))}(t,s)}},u.a.createElement(K.a,{noGutters:!0},u.a.createElement(W.a,null,u.a.createElement("div",null,u.a.createElement(C.a,{type:"text",value:s,onChange:function(e){c(e.target.value)},onFocus:N,onBlur:x,className:"form-control form-control-lg bg-light border-light",placeholder:"Enter Message..."}))),u.a.createElement(W.a,{xs:"auto"},u.a.createElement("div",{className:"chat-input-links ml-md-2"},u.a.createElement("ul",{className:"list-inline mb-0"},u.a.createElement("li",{className:"list-inline-item"},u.a.createElement(w.a,{type:"submit",color:"primary",className:"font-size-16 btn-lg chat-send waves-effect waves-light"},u.a.createElement("i",{className:"ri-send-plane-2-fill"}))))))))))};var ee=Object(Q.h)(Object(h.b)((function(e){return{active_user:e.Chat.active_user,userSidebar:e.Layout.userSidebar}}),{openUserSidebar:V.g,setFullUser:V.j})((function(e){var t=Object(o.useRef)(),a=Object(o.useState)([]),s=Object(E.a)(a,2),c=s[0],l=s[1];Object(o.useEffect)((function(){e.chats.length>0&&l(e.chats[e.active_user].messages),t.current.recalculate(),t.current.el&&(t.current.getScrollElement().scrollTop=t.current.getScrollElement().scrollHeight)}),[e.active_user,e.chats]);var i=function(){var t=Object(n.a)(r.a.mark((function t(a,s){var n,c,l,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.chats[e.active_user].docid,c=e.userEmail,l=Date.now(),i=Date.now(),!a||""===a){t.next=7;break}return t.next=7,Object(P.b)().firestore().collection("chats").doc(n).update({messages:Object(P.b)().f().firestore.FieldValue.arrayUnion({sender:c,message:a,time:l,type:"text"}),time:i});case 7:m();case 8:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}();function m(){t.current.el&&(t.current.getScrollElement().scrollTop=t.current.getScrollElement().scrollHeight)}return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"user-chat w-100"},u.a.createElement("div",{className:"d-lg-flex"},u.a.createElement("div",{className:e.userSidebar?"w-70":"w-100"},u.a.createElement(Z,{chats:e.chats,allUserData:e.allUserData,userEmail:e.userEmail}),u.a.createElement(S.a,{style:{maxHeight:"100%"},ref:t,className:"chat-conversation p-3 p-lg-4",id:"messages"},u.a.createElement("ul",{className:"list-unstyled mb-0"},c.length>0?c.map((function(t,a){return!0===(t.time.seconds,!1)?u.a.createElement("li",{key:"dayTitle"+a},u.a.createElement("div",{className:"chat-day-title"},u.a.createElement("span",{className:"title"},"Today"))):u.a.createElement("li",{key:a,className:t.sender===e.userEmail?"right":""},u.a.createElement("div",{className:"conversation-list"},c[a+1]&&c[a].sender===c[a+1].sender?u.a.createElement("div",{className:"chat-avatar"},u.a.createElement("div",{className:"blank-div"})):u.a.createElement("div",{className:"chat-avatar"},t.sender===e.userEmail?u.a.createElement("img",{src:e.allUserData.find((function(t){return t.email===e.userEmail})).image,alt:"letsChat"}):"Null"===e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).image?u.a.createElement("div",{className:"chat-user-img align-self-center mr-3"},u.a.createElement("div",{className:"avatar-xs"},u.a.createElement("span",{className:"avatar-title rounded-circle bg-soft-primary text-primary"},e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).name.charAt(0)))):u.a.createElement("img",{src:e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).image,alt:"letsChat"})),u.a.createElement("div",{className:"user-chat-content"},u.a.createElement("div",{className:"ctext-wrap"},u.a.createElement("div",{className:"ctext-wrap-content"},t.message&&u.a.createElement("p",{className:"mb-0  text-left"},t.message),u.a.createElement("p",{className:"chat-time mb-0"}," ",u.a.createElement("span",{className:"align-middle"},t.time.seconds,"  ",u.a.createElement("i",{className:"ri-check-double-fill"})," ")))),c[a+1]&&c[a].sender===c[a+1].sender?null:u.a.createElement("div",{className:"conversation-name"},t.sender===e.userEmail?e.allUserData.find((function(t){return t.email===e.userEmail})).name:e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).name))))})):"No Messages")),u.a.createElement($,{onaddMessage:i,chats:e.chats[e.active_user],userEmail:e.userEmail})),u.a.createElement(q,{activeUser:e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))}))}))))}))),te=function(e){Object(i.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(c.a)(this,a);for(var s=arguments.length,l=new Array(s),i=0;i<s;i++)l[i]=arguments[i];return(e=t.call.apply(t,[this].concat(l))).state={newChatFormVisible:!1,email:null,chats:[],allUserData:[],user:[],blockList:[]},e.componentDidMount=Object(n.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Object(P.b)().auth().onAuthStateChanged(function(){var t=Object(n.a)(r.a.mark((function t(a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=4;break}e.props.history.push("/logout"),t.next=19;break;case 4:return t.prev=4,t.next=7,e.setState({user:a,email:a.email});case 7:return t.next=9,e.getAllUsersData();case 9:return t.next=11,e.getInfo(a);case 11:return t.next=13,e.onlineStatusUpdate(a.email);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(4),t.next=19,e.props.history.push("/logout");case 19:case"end":return t.stop()}}),t,null,[[4,15]])})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)}))),e.onlineStatusUpdate=function(){var t=Object(n.a)(r.a.mark((function t(a){var s,c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(P.b)().firestore().collection("users").where("email","==",a).get().then((function(e){return e.docs.map((function(e){return e.id}))[0]}));case 2:s=t.sent,c=setTimeout(Object(n.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"undefined"===s){t.next=6;break}return t.next=4,Object(P.b)().firestore().collection("users").doc(s).update({isOnline:!0});case 4:t.next=8;break;case 6:return t.next=8,e.onlineStatusUpdate();case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0),e.props.history.push("/logout");case 14:clearTimeout(c);case 15:case"end":return t.stop()}}),t,null,[[0,10]])}))),2e3);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.getAllUsersData=Object(n.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(P.b)().firestore().collection("users").onSnapshot(function(){var t=Object(n.a)(r.a.mark((function t(a){var s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=a.docs.map((function(e){return e.data()})),t.next=3,e.setState({allUserData:s});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))),e.getInfo=function(){var t=Object(n.a)(r.a.mark((function t(a,s){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(P.b)().firestore().collection("chats").where("users","array-contains",a.email).onSnapshot(function(){var t=Object(n.a)(r.a.mark((function t(n){var c,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((c=n.docs.map((function(e){return e.data()}))).sort((function(e,t){return e.time<t.time?1:e.time>t.time?-1:0})),l=[],!s){t.next=7;break}return t.next=6,c.filter((function(e){var t=e.users[0]!==a.email?e.users[0]:e.users[1];if(s.includes(t))return e}));case 6:l=t.sent;case 7:if(s){t.next=12;break}return t.next=10,e.setState({email:a.email,chats:c});case 10:t.next=14;break;case 12:return t.next=14,e.setState({email:a.email,chats:l});case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.searchChat=function(){var t=Object(n.a)(r.a.mark((function t(a){var s,n,c,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.state,n=s.email,c=s.user,t.next=3,e.fetchSearchEmail(a,n);case 3:return l=t.sent,t.next=6,e.getInfo(c,l);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.fetchSearchEmail=function(){var t=Object(n.a)(r.a.mark((function t(a,s){var n,c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],c=e.state.allUserData,t.next=4,c.map((function(e){-1!==e.name.indexOf(a)&&e.email!==s&&n.push(e.email)}));case 4:return t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e}return Object(l.a)(a,[{key:"showChatSection",value:function(){this.setState({newChatFormVisible:!0})}},{key:"render",value:function(){return u.a.createElement(u.a.Fragment,null,this.state.chats.length>0?u.a.createElement(u.a.Fragment,null,u.a.createElement(G,{history:this.props.history,chats:this.state.chats,userEmail:this.state.email,allUserData:this.state.allUserData}),u.a.createElement(ee,{history:this.props.history,chats:this.state.chats,userEmail:this.state.email,allUserData:this.state.allUserData})):null)}}]),a}(o.Component)}}]);
//# sourceMappingURL=9.b749f285.chunk.js.map