(this.webpackJsonpchatvia=this.webpackJsonpchatvia||[]).push([[10],{378:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return ee}));var r=a(15),s=a.n(r),n=a(67),c=a(41),l=a(50),i=a(69),m=a(68),o=a(1),u=a.n(o),h=a(8),p=a(48),d=a(368),f=a(369),E=a(96),v=a(162),g=a(341),b=a(342),N=a(362),x=a(367),y=a(380),w=a(364),k=a(365),O=a(339),C=a(340),j=a(222),U=a(223),S=a(366),D=a(38),_=a(240),z=a(66),F=a(49),M=function(e){Object(i.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(c.a)(this,a);for(var r=arguments.length,l=new Array(r),i=0;i<r;i++)l[i]=arguments[i];return(e=t.call.apply(t,[this].concat(l))).state={searchChat:"",modal:!1,isOpenCollapse:!1,newChatUserEmail:"",newChatUserMessage:"",isOpenAlert:!1,errormessage:"",chatexistsId:""},e.goToChat=Object(n.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:alert("Chat Is Already Exists");case 1:case"end":return e.stop()}}),e)}))),e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=document.getElementById("conversation"+this.props.active_user);e&&e.classList.add("active")}},{key:"handleChange",value:function(e){console.log(e.target)}},{key:"toggle",value:function(){console.log(this.state),this.setState({modal:!this.state.modal})}},{key:"toggleCollapse",value:function(){this.setState({isOpenCollapse:!this.state.isOpenCollapse})}},{key:"openUserChat",value:function(e,t){e.preventDefault();var a=this.props.chats.indexOf(t);this.props.activeUser(a);var r=document.getElementById("chat-list"),s=e.target,n=null;if(r){for(var c=r.getElementsByTagName("li"),l=0;l<c.length;++l)c[l].classList.contains("active")&&c[l].classList.remove("active");for(var i=0;i<c.length;++i)if(c[i].contains(s)){n=c[i];break}}n&&n.classList.add("active");var m=document.getElementsByClassName("user-chat");m&&m[0].classList.add("user-chat-show");var o=document.getElementById("unRead"+t.id);o&&(o.style.display="none")}},{key:"userExists",value:function(){var e=Object(n.a)(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(F.b)().firestore().collection("users").get();case 2:return t=e.sent,e.prev=3,a=t.docs.map((function(e){return e.data().email})).includes(this.state.newChatUserEmail),e.abrupt("return",a);case 8:return e.prev=8,e.t0=e.catch(3),console.log(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"chatExists",value:function(){var e=Object(n.a)(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[this.state.newChatUserEmail,this.props.userEmail].sort().join(":"),e.next=3,Object(F.b)().firestore().collection("chats").doc(t).get();case 3:return a=e.sent,e.abrupt("return",a.exists);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createNewChat",value:function(){var e=Object(n.a)(s.a.mark((function e(){var t,a,r,n,c,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userExists();case 2:if(t=e.sent,a=this.state,r=a.newChatUserEmail,n=a.newChatUserMessage,c=this.props.userEmail,!r||!n||r===c){e.next=16;break}if(!t){e.next=13;break}return e.next=9,this.chatExists();case 9:l=e.sent;try{l?this.goToChat():(this.createChat(c,r,n),this.setState({modal:!this.state.modal}))}catch(s){console.log(s)}e.next=14;break;case 13:this.setState({errormessage:"User Is not registered",isOpenAlert:!0});case 14:e.next=17;break;case 16:this.setState({errormessage:"Please Enter Valid Data",isOpenAlert:!0});case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createChat",value:function(){var e=Object(n.a)(s.a.mark((function e(t,a,r){var n,c,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.state.newChatUserEmail,this.props.userEmail].sort().join(":"),c=Date.now(),l=Date.now(),console.log({docid:n,time:c,users:[t,a],typing:[],messages:[{message:r,sender:t,time:l,type:"text"}]}),e.next=6,Object(F.b)().firestore().collection("chats").doc(n).set({docid:n,time:c,users:[t,a],typing:[],messages:[{message:r,sender:t,time:l,type:"text"}]});case 6:case"end":return e.stop()}}),e,this)})));return function(t,a,r){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",null,u.a.createElement("div",{className:"px-4 pt-4"},u.a.createElement("div",{className:"user-chat-nav float-right"},u.a.createElement("div",{id:"create-group"},u.a.createElement(E.a,{onClick:function(){return e.setState({modal:!e.state.modal})},type:"button",color:"link",className:"text-decoration-none text-muted font-size-18 py-0"},u.a.createElement("i",{className:"ri-group-line mr-1"}))),u.a.createElement(v.a,{target:"create-group",placement:"bottom"},"New Chat")),u.a.createElement(y.a,{isOpen:this.state.modal,centered:!0,toggle:function(){return e.setState({modal:!e.state.modal})}},u.a.createElement(w.a,{tag:"h5",className:"modal-title font-size-16",toggle:function(){return e.setState({modal:!e.state.modal})}},"Start New Chat"),u.a.createElement(k.a,{className:"p-4"},u.a.createElement(O.a,null,u.a.createElement(C.a,{className:"mb-4"},u.a.createElement(j.a,{isOpen:this.state.isOpenAlert,color:"danger"},this.state.errormessage),u.a.createElement(U.a,{htmlFor:"newchatemail-input"},"User Email Id"),u.a.createElement(g.a,{type:"text",className:"form-control",id:"newchatemail-input",value:this.state.newChatUserEmail,onChange:function(t){return e.setState({newChatUserEmail:t.target.value})},placeholder:"Enter User Email ID"})),u.a.createElement(C.a,null,u.a.createElement(U.a,{htmlFor:"newChatmessage-input"},"Message"),u.a.createElement(g.a,{type:"text",className:"form-control",id:"newChatmessage-input",value:this.state.newChatUserMessage,onChange:function(t){return e.setState({newChatUserMessage:t.target.value})},placeholder:"Enter Message"})))),u.a.createElement(S.a,null,u.a.createElement(E.a,{type:"button",color:"link",onClick:function(){return e.setState({modal:!e.state.modal})}},"Close"),u.a.createElement(E.a,{type:"button",color:"primary",onClick:this.createNewChat.bind(this)},"Start Chatting"))),u.a.createElement("h4",{className:"mb-4"},"Chats"),u.a.createElement("div",{className:"search-box chat-search-box"},u.a.createElement(b.a,{size:"lg",className:"mb-3 bg-light rounded-lg"},u.a.createElement(N.a,{addonType:"prepend"},u.a.createElement(E.a,{color:"link",className:"text-muted pr-1 text-decoration-none",type:"button"},u.a.createElement("i",{className:"ri-search-line search-icon font-size-18"}))),u.a.createElement(g.a,{type:"text",value:this.state.searchChat,onChange:function(t){return e.handleChange(t)},className:"form-control bg-light",placeholder:"Search messages or users"})))),u.a.createElement("div",{className:"px-2"},u.a.createElement("h5",{className:"mb-3 px-3 font-size-16"},"Recent"),u.a.createElement(_.a,{style:{maxHeight:"100%"},className:"chat-message-list"},u.a.createElement("ul",{className:"list-unstyled chat-list chat-user-list",id:"chat-list"},this.props.chats.length>0?this.props.chats.map((function(t,a){return u.a.createElement("li",{key:a,id:"conversation"+a,className:a===e.props.active_user?"active":""},u.a.createElement(D.b,{to:"#",onClick:function(a){return e.openUserChat(a,t)}},u.a.createElement(x.a,null,u.a.createElement("div",{className:"chat-user-img "+t.status+" align-self-center mr-3"},u.a.createElement("img",{src:e.props.allUserData.map((function(a){return a.email===(t.users[0]!==e.props.userEmail?t.users[0]:t.users[1])?a.image:""})).join("").trim(""),className:"rounded-circle avatar-xs",alt:"letschat"}),t.status&&u.a.createElement("span",{className:"user-status"})),u.a.createElement(x.a,{body:!0,className:"overflow-hidden"},u.a.createElement("h5",{className:"text-truncate font-size-15 mb-1"},e.props.allUserData.map((function(a){return a.email===(t.users[0]!==e.props.userEmail?t.users[0]:t.users[1])?a.name:""}))),u.a.createElement("p",{className:"chat-user-message text-truncate mb-0"},t.typing.length>0&&t.typing.includes(e.props.userEmail)?u.a.createElement(u.a.Fragment,null,"typing",u.a.createElement("span",{className:"animate-typing"},u.a.createElement("span",{className:"dot ml-1"}),u.a.createElement("span",{className:"dot ml-1"}),u.a.createElement("span",{className:"dot ml-1"}))):u.a.createElement(u.a.Fragment,null,t.messages&&t.messages.length>0?t.messages[t.messages.length-1].message:null))),u.a.createElement("div",{className:"font-size-11"},t.messages&&t.messages.length>0?t.messages[t.messages.length-1].time.seconds:null))))})):"No Chats Available")))))}}]),a}(u.a.Component),A=Object(p.b)((function(e){return{active_user:e.Chat.active_user}}),{setconversationNameInOpenChat:z.k,activeUser:z.a})(M);var L=Object(p.b)((function(e){return Object(h.a)({},e.Layout)}),null)((function(e){var t=e.activeTab;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"chat-leftsidebar mr-lg-1"},u.a.createElement(d.a,{activeTab:t},u.a.createElement(f.a,{tabId:"chat",id:"pills-chat"},u.a.createElement(A,{history:e.history,chats:e.chats,userEmail:e.userEmail,allUserData:e.allUserData})))))})),I=a(57),T=a(17),B=a(344),H=a(370),V=a(371),R=a(343);var J=function(e){var t=e.isOpen,a=e.toggleCollapse;return u.a.createElement(u.a.Fragment,null,u.a.createElement(D.b,{to:"#",onClick:a,className:"text-dark"},u.a.createElement(H.a,{id:"profile-user-headingOne"},u.a.createElement("h5",{className:"font-size-14 m-0"},e.iconClass&&u.a.createElement("i",{className:e.iconClass+" mr-2 align-middle d-inline-block"}),e.title,u.a.createElement("i",{className:t?"mdi mdi-chevron-up float-right accor-plus-icon":"mdi mdi-chevron-right float-right accor-plus-icon"})))),u.a.createElement(V.a,{isOpen:t},u.a.createElement(R.a,null,e.children)))};var G=Object(p.b)((function(e){return{active_user:e.Chat.active_user,userSidebar:e.Layout.userSidebar}}),{closeUserSidebar:z.c})((function(e){var t=Object(o.useState)(!0),a=Object(I.a)(t,2),r=a[0],s=a[1];return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{style:{display:!0===e.userSidebar?"block":"none"},className:"user-profile-sidebar"},u.a.createElement("div",{className:"px-3 px-lg-4 pt-3 pt-lg-4"},u.a.createElement("div",{className:"user-chat-nav text-right"},u.a.createElement(E.a,{color:"none",type:"button",onClick:function(){e.closeUserSidebar()},className:"nav-btn",id:"user-profile-hide"},u.a.createElement("i",{className:"ri-close-line"})))),u.a.createElement("div",{className:"text-center p-4 border-bottom"},u.a.createElement("div",{className:"mb-4 d-flex justify-content-center"},"Null"===e.activeUser.image?u.a.createElement("div",{className:"avatar-lg"},u.a.createElement("span",{className:"avatar-title rounded-circle bg-soft-primary text-primary font-size-24"},e.activeUser.name.charAt(0))):u.a.createElement("img",{src:e.activeUser.image,className:"rounded-circle avatar-lg img-thumbnail",alt:"letschat"})),u.a.createElement("h5",{className:"font-size-16 mb-1 text-truncate"},e.activeUser.name),u.a.createElement("p",{className:"text-muted text-truncate mb-1"},e.activeUser?u.a.createElement(u.a.Fragment,null," ",u.a.createElement("i",{className:"ri-record-circle-fill font-size-10 text-success mr-1"})," "):u.a.createElement(u.a.Fragment,null," ",u.a.createElement("i",{className:"ri-record-circle-fill font-size-10 text-secondary mr-1"})),"Active")),u.a.createElement(_.a,{style:{maxHeight:"100%"},className:"p-4 user-profile-desc"},u.a.createElement("div",{className:"text-muted"},u.a.createElement("p",{className:"mb-4"},'"',"If several languages coalesce, the grammar of the resulting language is more simple and regular than that of the individual.",'"')),u.a.createElement("div",{id:"profile-user-accordion",className:"custom-accordion"},u.a.createElement(B.a,{className:"shadow-none border mb-2"},u.a.createElement(J,{title:"About",iconClass:"ri-user-2-line",isOpen:r,toggleCollapse:function(){s(!r)}},u.a.createElement("div",null,u.a.createElement("p",{className:"text-muted mb-1"},"Name"),u.a.createElement("h5",{className:"font-size-14"},e.activeUser.name)),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Email"),u.a.createElement("h5",{className:"font-size-14"},e.activeUser.email)),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Description"),u.a.createElement("h5",{className:"font-size-14"},e.activeUser.description)),u.a.createElement("div",{className:"mt-4"},u.a.createElement("p",{className:"text-muted mb-1"},"Location"),u.a.createElement("h5",{className:"font-size-14 mb-0"},e.activeUser.location))))))))})),P=a(345),q=a(346),K=a(159),Q=a(163),W=a(160),X=a(161);var Y=Object(p.b)((function(e){var t=e.Chat.active_user;return Object(h.a)(Object(h.a)({},e.Layout),{},{active_user:t})}),{openUserSidebar:z.g,setFullUser:z.j})((function(e){var t=Object(o.useState)(!1),a=Object(I.a)(t,2),r=(a[0],a[1],Object(o.useState)(!1)),s=Object(I.a)(r,2),n=s[0],c=s[1],l=function(t){t.preventDefault(),e.openUserSidebar()};return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"p-3 p-lg-4 border-bottom"},u.a.createElement(P.a,{className:"align-items-center"},u.a.createElement(q.a,{sm:4,xs:8},u.a.createElement(x.a,{className:"align-items-center"},u.a.createElement("div",{className:"d-block d-lg-none mr-2"},u.a.createElement(D.b,{to:"#",onClick:function(e){return function(e){e.preventDefault();var t=document.getElementsByClassName("user-chat");t&&t[0].classList.remove("user-chat-show")}(e)},className:"user-chat-remove text-muted font-size-16 p-2"},u.a.createElement("i",{className:"ri-arrow-left-s-line"}))),u.a.createElement("div",{className:"mr-3"},u.a.createElement("img",{src:e.allUserData.map((function(t){return t.email===(e.chats[e.active_user].users[0]!==e.userEmail?e.chats[e.active_user].users[0]:e.chats[e.active_user].users[1])?t.image:""})).join("").trim(""),className:"rounded-circle avatar-xs",alt:"letschat"})),u.a.createElement(x.a,{body:!0,className:"overflow-hidden"},u.a.createElement("h5",{className:"font-size-16 mb-0 text-truncate"},u.a.createElement(D.b,{to:"#",onClick:function(e){return l(e)},className:"text-reset user-profile-show"},e.allUserData.map((function(t){return t.email===(e.chats[e.active_user].users[0]!==e.userEmail?e.chats[e.active_user].users[0]:e.chats[e.active_user].users[1])?t.name:""}))),e.allUserData.map((function(t){return t.email===(e.chats[e.active_user].users[0]!==e.userEmail?e.chats[e.active_user].users[0]:e.chats[e.active_user].users[1])&&t.isOnline?u.a.createElement(u.a.Fragment,null,u.a.createElement("i",{className:"ri-record-circle-fill font-size-10 text-success d-inline-block ml-1"})):u.a.createElement(u.a.Fragment,null,u.a.createElement("i",{className:"ri-record-circle-fill font-size-10 text-secondary d-inline-block ml-1"}))})))))),u.a.createElement(q.a,{sm:8,xs:4},u.a.createElement("ul",{className:"list-inline user-chat-nav text-right mb-0"},u.a.createElement("li",{className:"list-inline-item d-none d-lg-inline-block"},u.a.createElement(E.a,{type:"button",color:"none",onClick:function(e){return l(e)},className:"nav-btn user-profile-show"},u.a.createElement("i",{className:"ri-user-2-line"}))),u.a.createElement("li",{className:"list-inline-item"},u.a.createElement(K.a,{isOpen:n,toggle:function(){return c(!n)}},u.a.createElement(Q.a,{className:"btn nav-btn ",color:"none",type:"button"},u.a.createElement("i",{className:"ri-more-fill"})),u.a.createElement(W.a,{right:!0},u.a.createElement(X.a,{className:"d-block d-lg-none user-profile-show",onClick:function(e){return l(e)}},"View profile"," ",u.a.createElement("i",{className:"ri-user-2-line float-right text-muted"}))))))))))}));a(361),a(348);var Z=function(e){var t=Object(o.useState)(""),a=Object(I.a)(t,2),r=a[0],s=a[1],n=Object(o.useState)(!1),c=Object(I.a)(n,2),l=(c[0],c[1],Object(o.useState)({name:"",size:""})),i=Object(I.a)(l,2),m=i[0],h=i[1],p=Object(o.useState)(""),d=Object(I.a)(p,2),f=d[0],v=d[1];return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"p-3 p-lg-4 border-top mb-0"},u.a.createElement(O.a,{onSubmit:function(t){return function(t,a){t.preventDefault(),""!==a&&(e.onaddMessage(a,"textMessage"),s("")),""!==m.name&&(e.onaddMessage(m,"fileMessage"),h({name:"",size:""})),""!==f&&(e.onaddMessage(f,"imageMessage"),v(""))}(t,r)}},u.a.createElement(P.a,{noGutters:!0},u.a.createElement(q.a,null,u.a.createElement("div",null,u.a.createElement(g.a,{type:"text",value:r,onChange:function(e){s(e.target.value)},className:"form-control form-control-lg bg-light border-light",placeholder:"Enter Message..."}))),u.a.createElement(q.a,{xs:"auto"},u.a.createElement("div",{className:"chat-input-links ml-md-2"},u.a.createElement("ul",{className:"list-inline mb-0"},u.a.createElement("li",{className:"list-inline-item"},u.a.createElement(E.a,{type:"submit",color:"primary",className:"font-size-16 btn-lg chat-send waves-effect waves-light"},u.a.createElement("i",{className:"ri-send-plane-2-fill"}))))))))))};var $=Object(T.h)(Object(p.b)((function(e){return{active_user:e.Chat.active_user,userSidebar:e.Layout.userSidebar}}),{openUserSidebar:z.g,setFullUser:z.j})((function(e){var t=this,a=Object(o.useRef)(),r=Object(o.useState)([]),c=Object(I.a)(r,2),l=c[0],i=c[1];Object(o.useEffect)((function(){e.chats.length>0&&i(e.chats[e.active_user].messages),a.current.recalculate(),a.current.el&&(a.current.getScrollElement().scrollTop=a.current.getScrollElement().scrollHeight)}),[e.active_user,e.chats]);var m=function(){var t=Object(n.a)(s.a.mark((function t(a,r){var n,c,l,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.chats[e.active_user].docid,c=e.userEmail,l=Date.now(),console.log(l),i=Date.now(),!a||""===a){t.next=8;break}return t.next=8,Object(F.b)().firestore().collection("chats").doc(n).update({messages:Object(F.b)().f().firestore.FieldValue.arrayUnion({sender:c,message:a,time:l,type:"text"}),time:i});case 8:h();case 9:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}();function h(){a.current.el&&(a.current.getScrollElement().scrollTop=a.current.getScrollElement().scrollHeight)}return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"user-chat w-100"},u.a.createElement("div",{className:"d-lg-flex"},u.a.createElement("div",{className:e.userSidebar?"w-70":"w-100"},u.a.createElement(Y,{chats:e.chats,allUserData:e.allUserData,userEmail:e.userEmail}),u.a.createElement(_.a,{style:{maxHeight:"100%"},ref:a,className:"chat-conversation p-3 p-lg-4",id:"messages"},u.a.createElement("ul",{className:"list-unstyled mb-0"},l.length>0?l.map((function(a,r){return!0===(a.time.seconds,!1)?u.a.createElement("li",{key:"dayTitle"+r},u.a.createElement("div",{className:"chat-day-title"},u.a.createElement("span",{className:"title"},"Today"))):u.a.createElement("li",{key:r,className:a.sender===e.userEmail?"right":""},u.a.createElement("div",{className:"conversation-list"},l[r+1]&&l[r].sender===l[r+1].sender?u.a.createElement("div",{className:"chat-avatar"},u.a.createElement("div",{className:"blank-div"})):u.a.createElement("div",{className:"chat-avatar"},a.sender===e.userEmail?u.a.createElement("img",{src:e.allUserData.find((function(t){return t.email===e.userEmail})).image,alt:"letsChat"}):"Null"===e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).image?u.a.createElement("div",{className:"chat-user-img align-self-center mr-3"},u.a.createElement("div",{className:"avatar-xs"},u.a.createElement("span",{className:"avatar-title rounded-circle bg-soft-primary text-primary"},e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).name.charAt(0)))):u.a.createElement("img",{src:e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).image,alt:"letsChat"})),u.a.createElement("div",{className:"user-chat-content"},u.a.createElement("div",{className:"ctext-wrap"},u.a.createElement("div",{className:"ctext-wrap-content"},a.message&&u.a.createElement("p",{className:"mb-0"},a.message),e.chats[e.active_user].typing.length>0&&e.chats[e.active_user].typing.includes(t.props.userEmail)?u.a.createElement("p",{className:"mb-0"},"typing",u.a.createElement("span",{className:"animate-typing"},u.a.createElement("span",{className:"dot ml-1"}),u.a.createElement("span",{className:"dot ml-1"}),u.a.createElement("span",{className:"dot ml-1"}))):u.a.createElement("p",{className:"chat-time mb-0"}," ",u.a.createElement("span",{className:"align-middle"},a.time.seconds,"  ",u.a.createElement("i",{className:"ri-check-double-fill"})," ")))),l[r+1]?l[r].sender===l[r+1].sender?null:u.a.createElement("div",{className:"conversation-name"},a.sender===e.userEmail?e.allUserData.find((function(t){return t.email===e.userEmail})).name:e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).name):u.a.createElement("div",{className:"conversation-name"},"sender"===a.userType?"Admin":e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))})).name))))})):"No Messages")),u.a.createElement(Z,{onaddMessage:m})),u.a.createElement(G,{activeUser:e.allUserData.find((function(t){return t.email===e.chats[e.active_user].users.find((function(t){return t!==e.userEmail}))}))}))))}))),ee=function(e){Object(i.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(c.a)(this,a);for(var r=arguments.length,l=new Array(r),i=0;i<r;i++)l[i]=arguments[i];return(e=t.call.apply(t,[this].concat(l))).state={newChatFormVisible:!1,email:null,chats:[],allUserData:[],user:[],blockList:[]},e.componentDidMount=Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Object(F.b)().auth().onAuthStateChanged(function(){var t=Object(n.a)(s.a.mark((function t(a){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=4;break}e.props.history.push("/logout"),t.next=19;break;case 4:return t.prev=4,t.next=7,e.setState({user:a,email:a.email});case 7:return t.next=9,e.getAllUsersData();case 9:return t.next=11,e.getInfo(a);case 11:return t.next=13,e.onlineStatusUpdate(a.email);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(4),t.next=19,e.props.history.push("/logout");case 19:case"end":return t.stop()}}),t,null,[[4,15]])})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)}))),e.onlineStatusUpdate=function(){var t=Object(n.a)(s.a.mark((function t(a){var r,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(F.b)().firestore().collection("users").where("email","==",a).get().then((function(e){return e.docs.map((function(e){return e.id}))[0]}));case 2:r=t.sent,c=setTimeout(Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"undefined"===r){t.next=6;break}return t.next=4,Object(F.b)().firestore().collection("users").doc(r).update({isonline:!0,isverify:!0});case 4:t.next=8;break;case 6:return t.next=8,e.onlineStatusUpdate();case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0),e.props.history.push("/logout");case 14:clearTimeout(c);case 15:case"end":return t.stop()}}),t,null,[[0,10]])}))),2e3);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.getBlockList=Object(n.a)(s.a.mark((function t(){var a,r,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.state,r=a.allUserData,c=a.email,r.forEach(function(){var t=Object(n.a)(s.a.mark((function t(a){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.email!==c){t.next=3;break}return t.next=3,e.setState({blockList:a.blocklist});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))),e.getAllUsersData=Object(n.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(F.b)().firestore().collection("users").onSnapshot(function(){var t=Object(n.a)(s.a.mark((function t(a){var r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.docs.map((function(e){return e.data()})),t.next=3,e.setState({allUserData:r});case 3:return t.next=5,e.getBlockList();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))),e.getInfo=function(){var t=Object(n.a)(s.a.mark((function t(a,r){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(F.b)().firestore().collection("chats").where("users","array-contains",a.email).onSnapshot(function(){var t=Object(n.a)(s.a.mark((function t(n){var c,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((c=n.docs.map((function(e){return e.data()}))).sort((function(e,t){return e.time<t.time?1:e.time>t.time?-1:0})),l=[],!r){t.next=7;break}return t.next=6,c.filter((function(e){var t=e.users[0]!==a.email?e.users[0]:e.users[1];if(r.includes(t))return e}));case 6:l=t.sent;case 7:if(r){t.next=12;break}return t.next=10,e.setState({email:a.email,chats:c});case 10:t.next=14;break;case 12:return t.next=14,e.setState({email:a.email,chats:l});case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.searchChat=function(){var t=Object(n.a)(s.a.mark((function t(a){var r,n,c,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.state,n=r.email,c=r.user,t.next=3,e.fetchSearchEmail(a,n);case 3:return l=t.sent,t.next=6,e.getInfo(c,l);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.fetchSearchEmail=function(){var t=Object(n.a)(s.a.mark((function t(a,r){var n,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],c=e.state.allUserData,t.next=4,c.map((function(e){-1!==e.name.indexOf(a)&&e.email!==r&&n.push(e.email)}));case 4:return t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e}return Object(l.a)(a,[{key:"showChatSection",value:function(){this.setState({newChatFormVisible:!0})}},{key:"render",value:function(){return u.a.createElement(u.a.Fragment,null,u.a.createElement(L,{history:this.props.history,chats:this.state.chats,userEmail:this.state.email,allUserData:this.state.allUserData}),this.state.chats.length>0?u.a.createElement($,{history:this.props.history,chats:this.state.chats,userEmail:this.state.email,allUserData:this.state.allUserData}):null)}}]),a}(o.Component)}}]);
//# sourceMappingURL=10.3a7ce400.chunk.js.map